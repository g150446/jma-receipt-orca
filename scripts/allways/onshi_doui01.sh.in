#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    訪問診療一括同意返却
#        ${1} ジョブＩＤ
#        ${2} シェルＩＤ
#        ${3} 医療機関番号 
#        ${4} 一括同意ファイル名
#        ${5} エラーファイル名 
#-------------------------------------------#

cleanup(){
##      パラメータファイル削除
        if  [ -e "${PARA_FILE_FULL}" ]; then
            rm   ${PARA_FILE_FULL}
        fi
        if  [ -n "${ORCA_UID}" ]; then
            $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBDELTEMPDIR
        fi
}
trap cleanup EXIT

RENNUM=0

ERR_FILE_BASE=$(basename ${5})
ERR_FILE_FULL=${MCP_TEMPDIR}/${ERR_FILE_BASE}

LOG_FILE=/var/log/jma-receipt/${3}onshi_doui01.log
[ -e ${LOG_FILE} ] && rm ${LOG_FILE}
echo $(basename ${LOG_FILE})

[ -e ${ERR_FILE_FULL} ] && rm  ${ERR_FILE_FULL} 

echo $#

RENNUM=$(expr $RENNUM + 1) 
$DBSTUB -dir $LDDIRECTORY -bd orcabt ORAPI071BR1V2 -parameter "${1},${2},${3},${4},${5}"
if  [ -e ${ERR_FILE_FULL} ]; then
     exit
fi

#$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter "JBE${1}${2},${3}"
exit 
